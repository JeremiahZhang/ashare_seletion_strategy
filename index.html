<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A股全生命周期自适应估值罗盘</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Font Awesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chosen Palette: Warm Neutrals & Muted Earth Tones -->
    <!-- Background: #fdfbf7 (Warm Cream) -->
    <!-- Text: #2d3748 (Slate 800) -->
    <!-- Primary (Mature): #4a5568 (Slate 600) -> Muted Blue in Charts -->
    <!-- Secondary (Growth): #c05621 (Orange 700) -> Muted Red in Charts -->
    <!-- Tertiary (Cycle): #d69e2e (Yellow 600) -> Muted Gold in Charts -->
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        warm: {
                            50: '#fdfbf7',
                            100: '#f7f3eb',
                            200: '#eaddc5',
                            800: '#4a4036',
                            900: '#2d261f',
                        },
                        mature: '#3182ce',
                        growth: '#e53e3e',
                        cycle: '#d69e2e'
                    }
                }
            }
        }
    </script>

    <style>
        /* Chart Container Styling - Strict Adherence to Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 650px; /* Max width constraint */
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* Base height */
            max-height: 400px; /* Max height constraint */
            background-color: #ffffff;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        .tab-active {
            border-bottom: 3px solid #d69e2e;
            color: #2d3748;
            font-weight: 700;
        }

        .tab-inactive {
            border-bottom: 3px solid transparent;
            color: #718096;
        }
        
        .tab-inactive:hover {
            color: #4a5568;
            border-bottom: 3px solid #cbd5e0;
        }

        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>

    <!-- Application Structure Plan: 
         Designed as a "Valuation Compass" dashboard. 
         - Top Nav: Switches between the 3 core models + Overview + Portfolio.
         - Logic: The user flow moves from Understanding (Overview) -> Analyzing specific types (Models) -> Synthesis (Portfolio).
         - Why: The report emphasizes that different stocks need different tools. A tabbed interface prevents cognitive overload and allows the user to focus on one "tool" at a time (e.g., just calculating PEG).
    -->
    
    <!-- Visualization & Content Choices:
         - Overview: Cards for concepts. No charts to keep it simple initially.
         - Mature: Scatter plot (PB vs ROE) is the standard for visualizing "value trap" vs "good value".
         - Growth: Line chart for S-Curve/Penetration. This visualizes the concept of "Valuation Collapse" as penetration rises.
         - Cycle: Time-series with bands. Plotly is used here for better zoom/pan capabilities on time-series data.
         - Portfolio: Doughnut chart to visualize allocation percentages.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

</head>
<body class="bg-warm-50 text-warm-900 font-sans antialiased selection:bg-cycle selection:text-white">

    <!-- Header -->
    <header class="bg-white border-b border-warm-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-warm-900 text-white w-8 h-8 flex items-center justify-center rounded-lg font-bold">A</div>
                    <h1 class="text-xl font-bold tracking-tight text-warm-900">A股全生命周期自适应估值罗盘</h1>
                </div>
                <div class="hidden md:flex text-sm text-gray-500 gap-4">
                    <span><i class="fas fa-chart-line mr-1"></i> 数据驱动</span>
                    <span><i class="fas fa-shield-alt mr-1"></i> 风险适配</span>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex -mb-px overflow-x-auto no-scrollbar gap-6" aria-label="Tabs">
                <button onclick="switchTab('overview')" id="tab-overview" class="tab-active whitespace-nowrap py-4 px-1 text-sm font-medium transition-colors">
                    核心理念
                </button>
                <button onclick="switchTab('mature')" id="tab-mature" class="tab-inactive whitespace-nowrap py-4 px-1 text-sm font-medium transition-colors">
                    成熟期 (红利)
                </button>
                <button onclick="switchTab('growth')" id="tab-growth" class="tab-inactive whitespace-nowrap py-4 px-1 text-sm font-medium transition-colors">
                    成长期 (赛道)
                </button>
                <button onclick="switchTab('cycle')" id="tab-cycle" class="tab-inactive whitespace-nowrap py-4 px-1 text-sm font-medium transition-colors">
                    困境反转 (周期)
                </button>
                <button onclick="switchTab('portfolio')" id="tab-portfolio" class="tab-inactive whitespace-nowrap py-4 px-1 text-sm font-medium transition-colors text-cycle">
                    <i class="fas fa-layer-group mr-1"></i> 组合构建
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen">

        <!-- SECTION 1: OVERVIEW -->
        <section id="section-overview" class="space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6 md:p-8">
                <h2 class="text-2xl font-bold text-warm-900 mb-4">为什么由于“一把尺子”你会亏损？</h2>
                <p class="text-gray-600 leading-relaxed mb-6">
                    传统的估值陷阱在于试图用一种方法（比如市盈率 PE）去衡量所有公司。用PE去衡量亏损的科技股会错过牛股，去衡量周期高点的钢铁股会掉入陷阱。本系统基于<strong>“企业实力评估曲线”</strong>，将A股上市公司划分为三大类，分别采用不同的“中国特色”估值模型。
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Card 1 -->
                    <div class="bg-blue-50 rounded-lg p-6 border-t-4 border-mature">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-lg text-blue-900">1. 成熟期</h3>
                            <i class="fas fa-landmark text-blue-400 text-xl"></i>
                        </div>
                        <ul class="text-sm text-blue-800 space-y-2">
                            <li><strong>对象:</strong> 央企、银行、电力</li>
                            <li><strong>特征:</strong> 增速慢，现金流好</li>
                            <li><strong>核心指标:</strong> <span class="bg-white px-2 py-0.5 rounded font-mono font-bold">股息率 + PB-ROE</span></li>
                        </ul>
                    </div>
                    
                    <!-- Card 2 -->
                    <div class="bg-red-50 rounded-lg p-6 border-t-4 border-growth">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-lg text-red-900">2. 成长期</h3>
                            <i class="fas fa-rocket text-red-400 text-xl"></i>
                        </div>
                        <ul class="text-sm text-red-800 space-y-2">
                            <li><strong>对象:</strong> 出海、科技、医药</li>
                            <li><strong>特征:</strong> 利润增速 > 20%</li>
                            <li><strong>核心指标:</strong> <span class="bg-white px-2 py-0.5 rounded font-mono font-bold">PEG + 渗透率</span></li>
                        </ul>
                    </div>

                    <!-- Card 3 -->
                    <div class="bg-yellow-50 rounded-lg p-6 border-t-4 border-cycle">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-lg text-yellow-900">3. 困境反转</h3>
                            <i class="fas fa-recycle text-yellow-500 text-xl"></i>
                        </div>
                        <ul class="text-sm text-yellow-800 space-y-2">
                            <li><strong>对象:</strong> 养殖、面板、有色</li>
                            <li><strong>特征:</strong> 盈利波动极大</li>
                            <li><strong>核心指标:</strong> <span class="bg-white px-2 py-0.5 rounded font-mono font-bold">PB Band (历史极值)</span></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="switchTab('portfolio')" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-warm-900 hover:bg-warm-800 focus:outline-none transition-colors">
                    查看推荐投资组合 <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </section>

        <!-- SECTION 2: MATURE MODEL -->
        <section id="section-mature" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold text-warm-900 mb-2">成熟期模型：PB-ROE 与 股息锚定</h2>
                <p class="text-gray-600 text-sm">
                    对于实力见顶但现金流极好的企业（如银行、电力），不要指望业绩爆发。估值核心在于<strong>“类债券属性”</strong>和<strong>“资产质量”</strong>。
                    如果 ROE（净资产收益率）常年只有 5%，但 PB（市净率）高达 2 倍，这就是高估。A股铁律：PB数值不应长期大幅超过ROE数值。
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Tool: Dividend Calculator -->
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                        <h3 class="font-bold text-lg mb-4 flex items-center text-mature">
                            <i class="fas fa-calculator mr-2"></i> 股息价值计算器
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">企业股息率 (%)</label>
                                <input type="number" id="mature-dividend" value="5.5" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-mature focus:ring focus:ring-mature focus:ring-opacity-50 bg-gray-50 p-2 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">无风险收益率 (十年期国债) (%)</label>
                                <input type="number" id="mature-riskfree" value="2.2" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-mature focus:ring focus:ring-mature focus:ring-opacity-50 bg-gray-50 p-2 border">
                            </div>
                            <div class="pt-4 border-t border-gray-100">
                                <p class="text-sm text-gray-500">相对溢价倍数:</p>
                                <div id="mature-result" class="text-3xl font-bold text-green-600">2.50x</div>
                                <div id="mature-advice" class="text-sm font-medium mt-1 text-gray-600">建议：强力买入 (高息债替代品)</div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg text-sm text-blue-900">
                        <strong>操作纪律：</strong><br>
                        • 买入标准：股息率 > 5% 且历史分红稳定。<br>
                        • 卖出标准：股息率降至 3% 以下。<br>
                        • 防雷：避开 PB 远大于 ROE 的伪价值股。
                    </div>
                </div>

                <!-- Chart: PB-ROE Scatter -->
                <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                    <h3 class="font-bold text-lg mb-4 text-center">PB-ROE 匹配矩阵 (防雷图谱)</h3>
                    <div class="chart-container">
                        <canvas id="chart-mature"></canvas>
                    </div>
                    <p class="text-xs text-center text-gray-400 mt-2">横轴：ROE (盈利能力) | 纵轴：PB (估值贵贱)</p>
                </div>
            </div>
        </section>

        <!-- SECTION 3: GROWTH MODEL -->
        <section id="section-growth" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold text-warm-900 mb-2">成长期模型：PEG + 渗透率修正</h2>
                <p class="text-gray-600 text-sm">
                    对于实力快速攀升的企业（出海、科技），PE是有效的，但必须结合增速（G）。更重要的是<strong>行业渗透率</strong>。一旦渗透率超过40%（如光伏、锂电），即使增速还在，估值也会坍塌。
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Tool: PEG & Penetration -->
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                        <h3 class="font-bold text-lg mb-4 flex items-center text-growth">
                            <i class="fas fa-sliders-h mr-2"></i> 渗透率压力测试
                        </h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    行业渗透率: <span id="growth-penetration-val" class="font-bold text-growth">15%</span>
                                </label>
                                <input type="range" id="growth-penetration" min="0" max="80" value="15" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-growth">
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>萌芽 (0%)</span>
                                    <span>爆发 (20%)</span>
                                    <span>红海 (50%+)</span>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-md border border-gray-200">
                                <p class="text-sm font-medium text-gray-600">当前阶段适用的 PEG 上限:</p>
                                <div id="growth-peg-limit" class="text-3xl font-bold text-growth">1.2</div>
                                <div id="growth-phase-desc" class="text-xs text-gray-500 mt-1">戴维斯双击阶段 (业绩+估值双升)</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-red-50 p-4 rounded-lg text-sm text-red-900">
                        <strong>A股修正策略：</strong><br>
                        • <strong>低估区：</strong>PEG < 0.8 (机构抢筹)<br>
                        • <strong>泡沫区：</strong>PEG > 1.5<br>
                        • <strong>渗透率警报：</strong>当渗透率 > 40% 时，PEG 必须打折到 0.5 才安全（内卷开始）。
                    </div>
                </div>

                <!-- Chart: S-Curve -->
                <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                    <h3 class="font-bold text-lg mb-4 text-center">生命周期与估值上限演变</h3>
                    <div class="chart-container">
                        <canvas id="chart-growth"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: CYCLICAL MODEL -->
        <section id="section-cycle" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold text-warm-900 mb-2">困境反转模型：重置成本与PB Band</h2>
                <p class="text-gray-600 text-sm">
                    对于利润忽高忽低的周期股（猪肉、面板、航运），<strong>市盈率（PE）完全失效</strong>。策略是“高PE买入（业绩最差时），低PE卖出（业绩最好时）”。核心锚点是<strong>PB（市净率）</strong>的历史极值。
                </p>
            </div>

            <div class="grid grid-cols-1 gap-8">
                <!-- Interactive Plotly Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                    <div class="flex justify-between items-end mb-4">
                        <h3 class="font-bold text-lg text-cycle">周期股买卖模拟器</h3>
                        <div class="text-xs text-gray-500">
                            <span class="inline-block w-3 h-3 bg-green-200 mr-1 border border-green-500"></span> 安全买入区 (破净/历史低位)
                        </div>
                    </div>
                    <!-- Using Plotly for advanced area filling and interactivity -->
                    <div class="chart-container" style="height: 400px; max-height: 400px;">
                        <div id="plotly-cycle" class="w-full h-full"></div>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="bg-green-50 p-3 rounded border border-green-200">
                            <strong>买入逻辑：</strong> 
                            PB < 1 或跌破历史最低PB。此时市场认为工厂废铁都不值钱，是实力的绝对底线。
                        </div>
                        <div class="bg-red-50 p-3 rounded border border-red-200">
                            <strong>卖出逻辑：</strong> 
                            行业景气度高涨，PE看起来很低（因为分母E很大），但PB已经触及历史高位。
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: PORTFOLIO -->
        <section id="section-portfolio" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <h2 class="text-xl font-bold text-warm-900 mb-2">构建“哑铃型”投资组合</h2>
                <p class="text-gray-600 text-sm">
                    在现在的A股，“确定性”最贵。建议构建一个组合：以成熟期红利股为防守底仓，以成长期赛道股为进攻矛头，以周期股为卫星博弈。
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                        <h3 class="font-bold text-lg mb-4">调整仓位配置</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="flex justify-between text-sm font-medium text-gray-700">
                                    <span>成熟期 (底仓)</span>
                                    <span id="alloc-mature-val">50%</span>
                                </label>
                                <input type="range" id="alloc-mature" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-mature" oninput="updatePortfolio()">
                            </div>
                            
                            <div>
                                <label class="flex justify-between text-sm font-medium text-gray-700">
                                    <span>成长期 (进攻)</span>
                                    <span id="alloc-growth-val">30%</span>
                                </label>
                                <input type="range" id="alloc-growth" min="0" max="100" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-growth" oninput="updatePortfolio()">
                            </div>
                            
                            <div>
                                <label class="flex justify-between text-sm font-medium text-gray-700">
                                    <span>周期股 (博弈)</span>
                                    <span id="alloc-cycle-val">20%</span>
                                </label>
                                <input type="range" id="alloc-cycle" min="0" max="100" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-cycle" oninput="updatePortfolio()">
                            </div>

                            <div id="alloc-warning" class="text-xs text-red-500 font-bold hidden">总仓位不等于 100%</div>
                        </div>
                    </div>

                    <div class="bg-gray-800 text-white rounded-xl p-6">
                        <h4 class="font-bold mb-2">组合特征</h4>
                        <div id="portfolio-desc" class="text-sm opacity-90 leading-relaxed">
                            标准“哑铃型”配置。利用红利股的确定性分红抵抗波动，保留30%的高增长潜力，少量仓位博弈周期拐点暴利。
                        </div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-warm-200 p-6">
                    <div class="chart-container">
                        <canvas id="chart-portfolio"></canvas>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-warm-200 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-xs text-gray-400">
                本工具基于“企业生命周期实力评估”理论生成。<br>
                投资有风险，工具提供的估值仅供参考，不构成直接买卖建议。在现在的A股，确定性最贵。
            </p>
        </div>
    </footer>

    <!-- JS Logic -->
    <script>
        // State
        const state = {
            currentTab: 'overview',
            mature: { dividend: 5.5, riskFree: 2.2 },
            growth: { penetration: 15 },
            allocation: { mature: 50, growth: 30, cycle: 20 }
        };

        // Chart Instances
        let charts = {
            mature: null,
            growth: null,
            portfolio: null
        };

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Update UI State
            state.currentTab = tabId;
            
            // Hide all sections
            document.querySelectorAll('section[id^="section-"]').forEach(el => el.classList.add('hidden'));
            // Show target section
            document.getElementById(`section-${tabId}`).classList.remove('hidden');

            // Update Tab Styles
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            document.getElementById(`tab-${tabId}`).classList.add('tab-active');
            document.getElementById(`tab-${tabId}`).classList.remove('tab-inactive');

            // Trigger Chart Rendering if needed
            if (tabId === 'mature' && !charts.mature) initMatureChart();
            if (tabId === 'growth' && !charts.growth) initGrowthChart();
            if (tabId === 'cycle') initCycleChart(); // Plotly handles resize better on re-call
            if (tabId === 'portfolio' && !charts.portfolio) initPortfolioChart();
        }

        // --- Mature Model Logic ---
        function updateMatureCalc() {
            const div = parseFloat(document.getElementById('mature-dividend').value);
            const risk = parseFloat(document.getElementById('mature-riskfree').value);
            
            if (!div || !risk) return;

            const ratio = (div / risk).toFixed(2);
            const resultEl = document.getElementById('mature-result');
            const adviceEl = document.getElementById('mature-advice');

            resultEl.innerText = `${ratio}x`;

            if (div < 3.0) {
                resultEl.className = 'text-3xl font-bold text-red-600';
                adviceEl.innerText = "建议：卖出/减仓 (性价比极低)";
                adviceEl.className = "text-sm font-medium mt-1 text-red-600";
            } else if (div > 5.0) {
                resultEl.className = 'text-3xl font-bold text-green-600';
                adviceEl.innerText = "建议：强力买入 (高息债替代品)";
                adviceEl.className = "text-sm font-medium mt-1 text-green-600";
            } else {
                resultEl.className = 'text-3xl font-bold text-yellow-600';
                adviceEl.innerText = "建议：持有 (合理区间)";
                adviceEl.className = "text-sm font-medium mt-1 text-yellow-600";
            }
        }

        document.getElementById('mature-dividend').addEventListener('input', updateMatureCalc);
        document.getElementById('mature-riskfree').addEventListener('input', updateMatureCalc);

        function initMatureChart() {
            const ctx = document.getElementById('chart-mature').getContext('2d');
            
            // Data points: x=ROE, y=PB
            // Logic: PB should roughly equal ROE/10 + premium. 
            // Value Trap: ROE 5, PB 2.
            // Value Buy: ROE 15, PB 1.5.
            
            charts.mature = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: '高估/泡沫 (PB >> ROE)',
                            data: [{x: 5, y: 2.2}, {x: 8, y: 2.5}, {x: 10, y: 3.0}],
                            backgroundColor: 'rgba(239, 68, 68, 0.7)', // Red
                            pointRadius: 6
                        },
                        {
                            label: '合理区间',
                            data: [{x: 15, y: 2.0}, {x: 20, y: 3.5}, {x: 12, y: 1.5}],
                            backgroundColor: 'rgba(214, 158, 46, 0.7)', // Yellow
                            pointRadius: 6
                        },
                        {
                            label: '低估/黄金坑 (PB << ROE)',
                            data: [{x: 15, y: 1.0}, {x: 18, y: 1.2}, {x: 10, y: 0.6}],
                            backgroundColor: 'rgba(72, 187, 120, 0.7)', // Green
                            pointRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'ROE 净资产收益率 (%)' }, min: 0, max: 25 },
                        y: { title: { display: true, text: 'PB 市净率 (倍)' }, min: 0, max: 4 }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `PB: ${context.parsed.y}x, ROE: ${context.parsed.x}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Growth Model Logic ---
        function updateGrowthCalc() {
            const penetration = parseInt(document.getElementById('growth-penetration').value);
            document.getElementById('growth-penetration-val').innerText = `${penetration}%`;
            
            const limitEl = document.getElementById('growth-peg-limit');
            const descEl = document.getElementById('growth-phase-desc');
            const penValEl = document.getElementById('growth-penetration-val');

            let pegLimit = 1.0;
            if (penetration < 10) {
                pegLimit = 1.0;
                descEl.innerText = "萌芽期：看不清格局，估值给不高";
                penValEl.className = "font-bold text-gray-500";
            } else if (penetration >= 10 && penetration <= 30) {
                pegLimit = 1.5;
                descEl.innerText = "戴维斯双击：业绩+估值双升，享受溢价";
                penValEl.className = "font-bold text-growth";
            } else if (penetration > 40) {
                pegLimit = 0.5;
                descEl.innerText = "内卷杀估值：增速虽在，但估值体系坍塌";
                penValEl.className = "font-bold text-red-800";
            } else {
                pegLimit = 1.0;
                descEl.innerText = "成长期中后段：回归合理 PEG=1";
                penValEl.className = "font-bold text-yellow-600";
            }
            limitEl.innerText = pegLimit;

            // Update Chart Line
            if (charts.growth) {
                // Update the "Current Position" point on the chart
                charts.growth.data.datasets[1].data = [{x: penetration, y: pegLimit}];
                charts.growth.update();
            }
        }

        document.getElementById('growth-penetration').addEventListener('input', updateGrowthCalc);

        function initGrowthChart() {
            const ctx = document.getElementById('chart-growth').getContext('2d');
            
            // S-Curve logic for valuation multiplier
            // x: Penetration 0-100
            // y: PEG Multiplier
            const dataPoints = [];
            for(let i=0; i<=80; i+=5) {
                let y = 1;
                if(i < 10) y = 1.0; 
                else if (i <= 30) y = 1.5; // High Hype
                else if (i <= 40) y = 1.0; // Normalizing
                else y = 0.5; // Crashing/Commoditized
                dataPoints.push({x: i, y: y});
            }

            charts.growth = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'PEG 估值上限曲线',
                            data: dataPoints,
                            borderColor: '#e53e3e',
                            backgroundColor: 'rgba(229, 62, 62, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: '当前位置',
                            data: [{x: 15, y: 1.5}],
                            backgroundColor: '#2d3748',
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            type: 'scatter'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', title: { display: true, text: '行业渗透率 (%)' }, min: 0, max: 80 },
                        y: { title: { display: true, text: '合理 PEG 倍数' }, min: 0, max: 2 }
                    }
                }
            });
        }

        // --- Cycle Model Logic ---
        function initCycleChart() {
            const container = document.getElementById('plotly-cycle');
            // Generate dummy time series data
            let time = [];
            let pb = [];
            let price = [];
            let buyZone = [];
            
            for (let i = 0; i < 100; i++) {
                time.push(i);
                // Create a cycle
                const cycle = Math.sin(i / 10); 
                // PB oscillates between 0.8 and 3
                const pbVal = 1.9 + cycle * 1.1 + (Math.random() * 0.2); 
                pb.push(pbVal);
                // Price follows PB
                price.push(pbVal * 10);
                // Buy zone constant line
                buyZone.push(1.0); 
            }

            const tracePB = {
                x: time,
                y: pb,
                type: 'scatter',
                mode: 'lines',
                name: 'PB (市净率)',
                line: { color: '#d69e2e', width: 3 },
                fill: 'tozeroy', // Fill to create a visual "mountain"
                fillcolor: 'rgba(214, 158, 46, 0.1)' 
            };

            const traceBuyLine = {
                x: time,
                y: buyZone,
                type: 'scatter',
                mode: 'lines',
                name: '破净买入线 (PB=1)',
                line: { color: '#48bb78', width: 2, dash: 'dash' }
            };

            const layout = {
                margin: { t: 20, l: 40, r: 20, b: 40 },
                showlegend: true,
                legend: { orientation: 'h', y: 1.1 },
                xaxis: { title: '时间 (年)', showticklabels: false },
                yaxis: { title: 'PB 估值水位', range: [0, 4] },
                shapes: [
                    {
                        type: 'rect',
                        xref: 'paper', yref: 'y',
                        x0: 0, x1: 1,
                        y0: 0, y1: 1.0,
                        fillcolor: 'rgba(72, 187, 120, 0.2)',
                        line: { width: 0 }
                    }
                ]
            };
            
            const config = { responsive: true, displayModeBar: false };

            Plotly.newPlot(container, [tracePB, traceBuyLine], layout, config);
        }

        // --- Portfolio Logic ---
        function updatePortfolio() {
            const m = parseInt(document.getElementById('alloc-mature').value);
            const g = parseInt(document.getElementById('alloc-growth').value);
            const c = parseInt(document.getElementById('alloc-cycle').value);

            document.getElementById('alloc-mature-val').innerText = m + '%';
            document.getElementById('alloc-growth-val').innerText = g + '%';
            document.getElementById('alloc-cycle-val').innerText = c + '%';

            const total = m + g + c;
            const warningEl = document.getElementById('alloc-warning');
            const descEl = document.getElementById('portfolio-desc');

            if (total !== 100) {
                warningEl.classList.remove('hidden');
                warningEl.innerText = `当前总仓位: ${total}% (需调整为100%)`;
            } else {
                warningEl.classList.add('hidden');
            }

            // Update Description based on mix
            if (m > 60) descEl.innerText = "防御型组合：极度厌恶风险，以吃股息躺平为主。适合熊市末期或保守投资者。";
            else if (g > 60) descEl.innerText = "激进型组合：全仓赌赛道，波动极大。若遇上风格切换可能面临大幅回撤。";
            else if (c > 50) descEl.innerText = "投机型组合：过度博弈周期拐点，风险极高，非专业人士慎用。";
            else descEl.innerText = "标准哑铃型配置：利用红利股的确定性分红抵抗波动，保留30%的高增长潜力，少量仓位博弈周期拐点暴利。";

            // Update Chart
            if (charts.portfolio) {
                charts.portfolio.data.datasets[0].data = [m, g, c];
                charts.portfolio.update();
            }
        }

        function initPortfolioChart() {
            const ctx = document.getElementById('chart-portfolio').getContext('2d');
            charts.portfolio = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['成熟期 (底仓)', '成长期 (进攻)', '周期股 (卫星)'],
                    datasets: [{
                        data: [50, 30, 20],
                        backgroundColor: [
                            '#3182ce', // Mature Blue
                            '#e53e3e', // Growth Red
                            '#d69e2e'  // Cycle Yellow
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Initialize default
        updateMatureCalc();

    </script>
</body>
</html>